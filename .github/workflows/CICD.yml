name: CI/CD

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
  workflow_dispatch:

jobs:
  Setup:
    runs-on: ubuntu-latest

    steps:
      - name: Placeholder
        run: echo setting up!
          

  BackendDevDeploy:
    name: Deploy Backend to Dev Env
    if: github.event_name == 'pull_request'
    needs: [Setup]

    uses: ./.github/workflows/deploy-backend.yml
    with:
      environment: development

  
  FrontendDevDeploy:
    name: Deploy Frontend to Dev Env
    if: github.event_name == 'pull_request'
    needs: [Setup]
    runs-on: ubuntu-latest
    environment:
      name: development
    steps:
      - name: Placeholder
        run: echo I am deploying!

    
  BackendTestDeploy:
    name: Deploy Backend to Test Env
    if: github.event.ref == 'refs/heads/master'
    needs: [Setup]
    runs-on: ubuntu-latest
    environment:
        name: testing
    steps:
        - name: Placeholder
          run: echo I am deploying!

  FrontendTestDeploy:
    name: Deploy Frontend to Test Env
    if: github.event.ref == 'refs/heads/master'
    needs: [Setup]
    runs-on: ubuntu-latest
    environment:
      name: testing
    steps:
      - name: Placeholder
        run: echo I am deploying!


  BackendQADeploy:
    name: Deploy Backend to QA Env
    needs: [FrontendTestDeploy, BackendTestDeploy]
    runs-on: ubuntu-latest
    environment:
      name: QA
    steps:
      - name: Placeholder
        run: echo I am deploying!


  FrontendQADeploy:
    name: Deploy Backend to QA Env
    needs: [FrontendTestDeploy, BackendTestDeploy]
    runs-on: ubuntu-latest
    environment:
      name: QA
    steps:
      - name: Placeholder
        run: echo I am deploying!
